CREATE SEQUENCE IF NOT EXISTS producto_idproducto_seq;

CREATE TABLE "producto" (
    "nombre" varchar(255) NOT NULL,
    "unidadmedida" varchar(255) NOT NULL,
    "idproducto" int4 NOT NULL DEFAULT nextval('producto_idproducto_seq'::regclass),
    PRIMARY KEY ("idproducto")
);

CREATE UNIQUE INDEX prod_idprod_pk ON producto USING btree (idproducto)

CREATE TABLE "persona" (
    "nit" varchar(11) NOT NULL,
    "tiponit" bpchar(2) NOT NULL,
    "nombre" varchar(255) NOT NULL,
    "apellidos" varchar(255) NOT NULL,
    "correo" varchar(255) NOT NULL,
    "genero" bpchar(1) NOT NULL,
    PRIMARY KEY ("nit")
);

CREATE UNIQUE INDEX per_nit_pk ON persona USING btree (nit)

CREATE SEQUENCE IF NOT EXISTS lote_idlote_seq;

CREATE TABLE "lote" (
    "fecharegistro" date NOT NULL,
    "idlote" int4 NOT NULL DEFAULT nextval('lote_idlote_seq'::regclass),
    PRIMARY KEY ("idlote")
);

CREATE UNIQUE INDEX lote_idlote_pk ON lote USING btree (idlote)

CREATE SEQUENCE IF NOT EXISTS factura_idfactura_seq;

CREATE TABLE "factura" (
    "fecha" date NOT NULL,
    "cliente" varchar(11) NOT NULL,
    "vendedor" varchar(11) NOT NULL,
    "tipopago" bpchar(1) NOT NULL,
    "idfactura" int4 NOT NULL DEFAULT nextval('factura_idfactura_seq'::regclass),
    CONSTRAINT "fac_client_fk" FOREIGN KEY ("cliente") REFERENCES "persona"("nit"),
    CONSTRAINT "fac_vendedor_fk" FOREIGN KEY ("vendedor") REFERENCES "persona"("nit"),
    PRIMARY KEY ("idfactura")
);

CREATE SEQUENCE IF NOT EXISTS producto_lote_idproducto_seq;
CREATE SEQUENCE IF NOT EXISTS producto_lote_idlote_seq;

CREATE TABLE "producto_lote" (
    "cantidad" int4 NOT NULL,
    "fechavencimiento" date,
    "idproducto" int4 NOT NULL DEFAULT nextval('producto_lote_idproducto_seq'::regclass),
    "idlote" int4 NOT NULL DEFAULT nextval('producto_lote_idlote_seq'::regclass),
    CONSTRAINT "producto_lote_idproducto_fkey" FOREIGN KEY ("idproducto") REFERENCES "producto"("idproducto"),
    CONSTRAINT "producto_lote_idlote_fkey" FOREIGN KEY ("idlote") REFERENCES "lote"("idlote")
);

CREATE UNIQUE INDEX fac_idfac_pk ON factura USING btree (idfactura)

CREATE TABLE "usuario" (
    "login" varchar(255) NOT NULL,
    "clave" varchar(255) NOT NULL,
    "tipousuario" bpchar(1) NOT NULL,
    "nit" varchar(11) NOT NULL,
    CONSTRAINT "user_nit_fk" FOREIGN KEY ("nit") REFERENCES "persona"("nit"),
    PRIMARY KEY ("login")
);

CREATE UNIQUE INDEX user_login_pk ON usuario USING btree (login)

CREATE SEQUENCE IF NOT EXISTS detalle_factura_idfactura_seq;
CREATE SEQUENCE IF NOT EXISTS detalle_factura_idproducto_seq;

CREATE TABLE "detalle_factura" (
    "cantidad" int4 NOT NULL,
    "iva" float8,
    "idfactura" int4 NOT NULL DEFAULT nextval('detalle_factura_idfactura_seq'::regclass),
    "idproducto" int4 NOT NULL DEFAULT nextval('detalle_factura_idproducto_seq'::regclass),
    CONSTRAINT "detalle_factura_idfactura_fkey" FOREIGN KEY ("idfactura") REFERENCES "factura"("idfactura"),
    CONSTRAINT "detalle_factura_idproducto_fkey" FOREIGN KEY ("idproducto") REFERENCES "producto"("idproducto")
);
